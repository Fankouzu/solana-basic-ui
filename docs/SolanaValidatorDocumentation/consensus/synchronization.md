# 同步
快速、可靠的同步能力是 Solana 能够实现如此高吞吐量的最主要原因。传统区块链通过区块同步大批量交易。由于采用区块同步，交易在特定的时间段（称为“区块时间”）过去之前无法被处理。在工作量证明（Proof of Work）共识机制中，为了减少多个验证者同时生成新有效区块的概率，这些区块时间必须设定得非常长（约10分钟）。在权益证明（Proof of Stake）共识机制中没有这样的限制，但如果没有可靠的时间戳，验证者无法确定收到的区块的顺序。常见的解决方法是给每个区块加上一个[壁钟时间戳](https://en.bitcoin.it/wiki/Block_timestamp)。由于时钟漂移和网络延迟的差异，这种时间戳只能在一到两个小时的范围内保持相对准确。为解决这一问题，这些系统通常会延长区块时间，以确保每个区块的时间戳中位数始终是递增的。

Solana 采取了一种非常不同的方法，它称之为*历史证明*或*PoH*。领导者节点使用加密证明对区块加盖“时间戳”，以表明自上次证明以来已经过去了一段时间。所有散列到证明中的数据肯定是在生成证明之前发生的。然后，节点与验证器节点共享新区块，验证器节点可以验证这些证明。区块可以按任何顺序到达验证器，甚至可以在几年后重放。有了这种可靠的同步保证，Solana 能够将区块分成更小的交易批次，称为*条目*。在任何区块共识概念之前，条目都会实时以流式传输到验证器。

从技术上讲，Solana 从不发送*区块*，而是使用该术语来描述验证者投票以获得*确认*的条目序列。这样，Solana 的确认时间就可以与基于区块的系统进行比较。当前实现将区块时间设置为 800 毫秒。

在底层，条目以与领导者节点将一组有效交易批处理成条目一样快的速度流式传输到验证器。验证器在对这些条目进行有效性投票之前很久就处理这些条目。通过乐观地处理交易，在收到最后一个条目的时间和节点可以投票的时间之间实际上没有延迟。如果**未**达成共识，节点只需回滚其状态。这种乐观处理技术于 1981 年推出，称为 [乐观并发控制](https://en.wikipedia.org/wiki/Optimistic_concurrency_control)。它可以应用于区块链架构，其中集群对代表整个分类账的哈希进行投票，直至某个*区块高度*。在 Solana 中，它是使用最后一个条目的 PoH 哈希轻松实现的。

## 与VDFs的关系

Solana 于 2017 年 11 月首次描述了历史证明（Proof of History）技术在区块链中的应用。次年 6 月，斯坦福大学描述了一种类似的技术，称为 [可验证延迟函数](https://eprint.iacr.org/2018/601.pdf) 或 *VDF*。

VDF 的一个理想特性是验证时间非常快。Solana 验证其延迟函数的方法与创建它所花费的时间成正比。它分布在 4000 个核心 GPU 上，足以满足 Solana 的需求，但如果你问上面引用的论文的作者，他们可能会告诉你 \([并且已告诉](https://github.com/solana-labs/solana/issues/388)\) Solana 的方法在算法上很慢，不应该被称为 VDF。我们认为术语 VDF 应该代表可验证延迟函数的类别，而不仅仅是具有某些性能特征的子集。在解决这个问题之前，Solana 可能会继续使用术语 PoH 来表示其特定于应用程序的 VDF。

PoH 和 VDF 之间的另一个区别是 VDF 仅用于跟踪持续时间。另一方面，PoH 的哈希链包括应用程序观察到的任何数据的哈希值。这些数据是一把双刃剑。一方面，数据“证明历史”——数据肯定在它之后的哈希值之前存在。另一方面，这意味着应用程序可以通过更改数据哈希值的时间来操纵哈希链。因此，PoH 链不能作为良好的随机性来源，而没有该数据的 VDF 则可以。例如，Solana 的 [领导者轮换算法](https://docs.solanalabs.com/consensus/leader-rotation) 仅来自 VDF *高度*，而不是其在该高度的哈希值。

## 与共识机制的关系

历史证明（Proof of History）不是一种共识机制，但它被用于提高 Solana 的权益证明（Proof of Stake）共识的性能。它还用于提高数据平面协议的性能。

## 更多关于历史证明的内容

- [水钟类比](https://medium.com/solana-labs/proof-of-history-explained-by-a-water-clock-e682183417b8)
- [历史证明概述](https://medium.com/solana-labs/proof-of-history-a-clock-for-blockchain-cf47a61a9274)
